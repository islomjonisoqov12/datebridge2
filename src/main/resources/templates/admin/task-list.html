<!doctype html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:insert="fragments/layout/head::head(${'마이페이지'})"/>
    <link rel="stylesheet" href="../assets/css/main.css">

    <style>
        .progress {
            border-radius: 10px;
        }

        .progress-wrapper {
            border-radius: 10px;
        }

        .bg-light-blue {
            background-color: #d7e7fd;
        }
    </style>
</head>
<body>
<!--◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆ #head ◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆-->
<th:block th:insert="fragments/homes/common::common(${'관리자 페이지'})"/>
<!--◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆ /#head ◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆-->
<hr class="dpn"/>
<div class="container">
    <div class="row pt-5 pb-5">
        <div class="col-3">
            <th:block th:insert="fragments/adminPageNavigation::adminPageNavi('list')"/>
        </div>
        <div class="col-9">
            <div class="p-4 progress-wrapper border border-grey mb-5">
                <div class="d-flex justify-content-between align-items-end">
                    <h2 class="font-weight-bold g-font-size-40 mb-0">전체진척율</h2>
                    <p class="mb-0" th:text="${avgRate + '%'}"></p>
                </div>
                <div class="progress g-height-20">
                    <div class="progress-bar bg-primary" role="progressbar" th:style="${'width:' + avgRate + '%'}"
                         aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>
            <table class="table table-bordered mb-5">
                <tbody>
                <colgroup>
                    <col style="width: 100px">
                    <col style="width: 40%">
                    <col style="width: 100px">
                    <col style="width: 40%">
                </colgroup>
                <tr>
                    <td class="bg-light-blue">작업명</td>
                    <td th:text="${projectInfo.getProjectName()}"></td>
                    <td class="bg-light-blue">작업시간</td>
                    <td>
                        <span th:if="${projectInfo.getProjectType() == 'survey'}">조사</span>
                        <span th:if="${projectInfo.getProjectType() == 'text'}">텍스트</span>
                        <span th:if="${projectInfo.getProjectType() == 'voice'}">보이스</span>
                        <span th:if="${projectInfo.getProjectType() == 'image'}">이미지</span>
                        <span th:if="${projectInfo.getProjectType() == 'project'}">프로젝트</span>
                    </td>
                </tr>
                <tr>
                    <td class="bg-light-blue">작업기간</td>
                    <td th:text="${projectInfo.getProjectStartDate() + '~' + projectInfo.getProjectEndDate()}"></td>
                    <td class="bg-light-blue">작업시간</td>
                    <td th:text="${projectInfo.getWorkDateInMinutes()}"></td>
                </tr>
                <tr>
                    <td class="bg-light-blue">작업내용</td>
                    <td th:text="${projectInfo.getProjectContent()}"></td>
                    <td class="bg-light-blue">포인트</td>
                    <td>
                        <div class="d-flex justify-content-between">
                            <span th:text="${projectInfo.getPointPerImage()}"></span>
                            <span th:text="${'전체 (' + totalPointByProject + ') pt'}"></span>
                        </div>
                    </td>
                </tr>

                </tbody>
            </table>
            <table class="table table-striped">
                <thead>
                <colgroup>
                    <col style="width: 60px">
                    <col style="width: auto">
                    <col style="width: 120px">
                    <col style="width: 120px">
                    <col style="width: 100px">
                    <col style="width: 100px">
                </colgroup>
                <tr>
                    <th class="border-top-0" scope="col">NO</th>
                    <th class="border-top-0" scope="col">태스크명</th>
                    <th class="border-top-0" scope="col">유저아이 <br/> 디(이름)</th>
                    <th class="border-top-0" scope="col">검수자아이 <br/>디(이름)</th>
                    <th class="border-top-0" scope="col">상태</th>
                    <th class="border-top-0" scope="col">건수</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="list, index : *{taskList}">
                    <td th:text="${index.count}"></td>
                    <td th:text="${list.getTaskName()}"></td>
                    <td th:text="${list.getUserId() + ' (' + list.getUserName() + ')'}"></td>
                    <td th:text="${list.getQcId() + ' (' + list.getQcName() + ')'}"></td>
                    <td>
                        <th:block th:if="${list.getTaskStatus() == 'COMPLETED'}">
                            <h2>
                                <button
                                        class="badge badge-success action-btn"
                                        th:disabled="${userInfo.getLoginId() != list.getQcId()}"
                                        th:attr="data-qcId=${list.getQcId()},data-loginId=${list.getUserId()},data-taskId=${list.getTaskId()}"
                                >
                                    작업완료
                                </button>
                            </h2>
                        </th:block>
                        <th:block th:if="${list.getTaskStatus() != 'COMPLETED'}">
                            <h2 th:if="${list.getTaskStatus() == 'IN_PROGRESS'}">
                                <span class="badge badge-warning">작업중</span>
                            </h2>
                            <h2 th:if="${list.getTaskStatus() == 'APPROVED'}">
                                <span class="badge badge-success">승인</span>
                            </h2>
                            <h2 th:if="${list.getTaskStatus() == 'UNASSIGNED'}">
                                <span class="badge badge-secondary">미할당</span>
                            </h2>
                            <h2 th:if="${list.getTaskStatus() == 'REJECTED'}">
                                <span class="badge badge-danger">반려</span>
                            </h2>
                        </th:block>


                    </td>
                    <td th:text="${list.getCntImageDoneAndApproved() + '/' + list.getCntImageInTask()}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
    $(document).on('ready', () => {

        $('.action-btn').on('click', (e) => {
            const target = e.currentTarget
            const qcId = target.getAttribute('data-qcId')
            const userId = target.getAttribute('data-loginId')
            const taskId = target.getAttribute('data-taskId')
            window.open(`https://makesense.netlify.app/?dtlSeq=${taskId}&userId=${userId}&qcId=${qcId}`, '_blank')
        })

    })

</script>
</body>
</html>